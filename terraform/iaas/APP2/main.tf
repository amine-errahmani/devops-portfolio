module "app2_scaleset" {
  source                    = "../modules/app2_ss"
  env_version               = data.template_file.version.rendered
  resource_group_locations  = data.terraform_remote_state.app2_main.outputs.app2_rg_locations
  resource_group_names      = data.terraform_remote_state.app2_main.outputs.app2_rg_names
  environment               = var.environment
  environment_short         = var.environment_short
  region_suffix             = var.region_suffix
  vm_size                   = var.vm_size_app
  nb_instance               = var.nb_instance
  app2_image_ids          = data.azurerm_shared_image_version.app2_image_version.*.id
  plan_name                 = var.plan_name
  plan_publisher            = var.plan_publisher
  plan_product              = var.plan_product
  disk_type                 = var.disk_type
  os_disk_size              = var.os_disk_size
  vendor_vnet_names           = var.vendor_vnet_names
  vendor_vnet_rgs             = var.vendor_vnet_rgs
  vendor_snet_names           = var.vendor_snet_names
  admin_username            = var.admin_username
  admin_password            = random_password.app2_admin_pass.result
  service_sp_name           = data.terraform_remote_state.app2_main.outputs.app2_service_sp_name
  service_sp_pass           = data.azurerm_key_vault_secret.service_sp.value
  encryption_set_ids        = var.encryption_set_ids
  tag_Environment           = var.tag_Environment
  tag_Service               = var.tag_Service
  tag_Solution              = var.tag_Solution
  tag_Component_app3         = var.tag_Component_app3
  tag_Component_app1     = var.tag_Component_app1
  tag_Component_app2      = var.tag_Component_app2
  tag_Component_batch       = var.tag_Component_batch
  tag_Component_app4         = var.tag_Component_app4
  tag_Criticality_tier1     = var.tag_Criticality_tier1
  tag_Criticality_tier2     = var.tag_Criticality_tier2
  tag_Criticality_tier3     = var.tag_Criticality_tier3
  tag_Autoscale             = var.tag_Autoscale
  tag_iMutability           = var.tag_iMutability
  tag_Mutability            = var.tag_Mutability
  tag_HA                    = var.tag_HA
  tag_DR                    = var.tag_DR
  tag_RPO_tier1             = var.tag_RPO_tier1
  tag_RPO_tier2             = var.tag_RPO_tier2
  tag_RPO_tier3             = var.tag_RPO_tier3
  tag_PCIDSS                = var.tag_PCIDSS
  tag_Department            = var.tag_Department
  tag_Stakeholder           = var.tag_Stakeholder
  tag_Contact               = var.tag_Contact
  tag_Monitoring            = var.tag_Monitoring
  tag_Secret_Name           = resource.azurerm_key_vault_secret.app2_secret.name
}

module "app2_batch" {
  source                    = "../modules/app2_batch"
  env_version               = data.template_file.version.rendered
  resource_group_locations  = data.terraform_remote_state.app2_main.outputs.app2_rg_locations
  resource_group_names      = data.terraform_remote_state.app2_main.outputs.app2_rg_names
  environment               = var.environment
  environment_short         = var.environment_short
  region_suffix             = var.region_suffix
  app2_b_VmSize           = var.app2_b_VmSize
  app2_image_ids          = data.azurerm_shared_image_version.app2_image_version.*.id
  plan_name                 = var.plan_name
  plan_publisher            = var.plan_publisher
  plan_product              = var.plan_product
  disk_type                 = var.disk_type
  os_disk_size              = var.os_disk_size
  vendor_vnet_names           = var.vendor_vnet_names
  vendor_vnet_rgs             = var.vendor_vnet_rgs
  vendor_snet_names           = var.vendor_snet_names
  admin_username            = var.admin_username
  admin_password            = random_password.app2_admin_pass.result
  service_sp_name           = data.terraform_remote_state.app2_main.outputs.app2_service_sp_name
  service_sp_pass           = data.azurerm_key_vault_secret.service_sp.value
  encryption_set_ids        = var.encryption_set_ids
  tag_Environment           = var.tag_Environment
  tag_Service               = var.tag_Service
  tag_Solution              = var.tag_Solution
  tag_Component_app3         = var.tag_Component_app3
  tag_Component_app1     = var.tag_Component_app1
  tag_Component_app2      = var.tag_Component_app2
  tag_Component_batch       = var.tag_Component_batch
  tag_Component_app4         = var.tag_Component_app4
  tag_Criticality_tier1     = var.tag_Criticality_tier1
  tag_Criticality_tier2     = var.tag_Criticality_tier2
  tag_Criticality_tier3     = var.tag_Criticality_tier3
  tag_Autoscale             = var.tag_Autoscale
  tag_iMutability           = var.tag_iMutability
  tag_Mutability            = var.tag_Mutability
  tag_HA                    = var.tag_HA
  tag_DR                    = var.tag_DR
  tag_RPO_tier1             = var.tag_RPO_tier1
  tag_RPO_tier2             = var.tag_RPO_tier2
  tag_RPO_tier3             = var.tag_RPO_tier3
  tag_PCIDSS                = var.tag_PCIDSS
  tag_Department            = var.tag_Department
  tag_Stakeholder           = var.tag_Stakeholder
  tag_Contact               = var.tag_Contact
  tag_Monitoring            = var.tag_Monitoring
  tag_Secret_Name           = resource.azurerm_key_vault_secret.app2_secret.name
}